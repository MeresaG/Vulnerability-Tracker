const jwt = require('jsonwebtoken');
const _helpers = require('../helpers/refactoringHelpers')

module.exports = function(req, res, next) {
    const token = req.header('auth-token');
    const response = _helpers.initResponse();
    if(!token) {
        response.status = process.env.HTTP_STATUS_UNAUTHORIZED;
        response.message = {message : "Access Denied"}
        return res.status(response.status).json(response.message);
    }

    try {
        const verified = jwt.verify(token, process.env.TOKEN_SECRET);
        req.personId = verified._id;
        next();

        
    } catch (error) {
        response.status = process.env.HTTP_STATUS_BAD_REQUEST;
        response.message = {message : "Invalid Token"}
        return res.status(response.status).json(response.message);
    }
}