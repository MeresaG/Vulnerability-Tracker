import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, FormGroupDirective, Validators } from '@angular/forms';
import { AuthService } from '../auth.service';

@Component({
  selector: 'app-register',
  templateUrl: './register.component.html',
  styleUrls: ['./register.component.css']
})
export class RegisterComponent implements OnInit {

  registerationForm: FormGroup;
  errorMessage = "";
  success = ""
  submitted:boolean = false;

  roles =  ['Administrator', 'Developer', 'Product Manager']
  constructor(private fb : FormBuilder, private authService:AuthService) { 
    this.registerationForm = this.fb.group({
      firstName :['', [Validators.required]],
      lastName: ['', Validators.required],
      userName:['', Validators.required],
      email:['', [Validators.required, Validators.email]],
      role:[''],
      password: ['', [
        Validators.required, 
        Validators.pattern('^(?=.*[A-Za-z])(?=.*[$@$!%*#?&]).{8,}$')
    ]]
    })
  }

  ngOnInit(): void {
    this.submitted = false;
  }

  register(formDirective : FormGroupDirective) {
    this.submitted = true;
    if(this.registerationForm.valid) {
      this.authService.register(this.registerationForm.value).subscribe(
        data => {
          this.success = "Successfully Registered!";
          this.submitted = false;
          this.registerationForm.reset();
          formDirective.resetForm();
  
        },
        err => {
         this.errorMessage = "Sorry failed."
        }
      )

    }
    
  }

}
