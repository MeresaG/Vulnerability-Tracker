import { AfterViewInit, Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup } from '@angular/forms';
import { Router } from '@angular/router';
import { VulnerabilityService } from '../vulnerability.service';
import * as M from 'materialize-css';

declare var document: any;

@Component({
  selector: 'app-add-vulnerability',
  templateUrl: './add-vulnerability.component.html',
  styleUrls: ['./add-vulnerability.component.css']
})
export class AddVulnerabilityComponent implements OnInit , AfterViewInit{

  statusOptions:string[] = ["opened", "in progress", "closed"]
  severityOptions:string[] = ["Low", "Medium", "High", "Critical"]
  vulnerabilityForm!: FormGroup;
  constructor(private fb : FormBuilder, private vulnerabilityServive:VulnerabilityService, private router:Router) {

    this.vulnerabilityForm = this.fb.group({
      vulnerabilityType : [''],
      projectName : [''],
      status: [''],
      severity: [''],
      description: ['']
    })

   }

  ngOnInit(): void {

    
  }

  ngAfterViewInit(){
    // initializing Selcet 
    M.FormSelect.init(document.querySelector('#status'));  
    M.FormSelect.init(document.querySelector('#severity'));  
}

  add() : void {

    console.log(this.vulnerabilityForm.value);
    if (confirm('Are you sure you want to add this vulnerability into the database?')) {
    this.vulnerabilityServive.addVulnerability(this.vulnerabilityForm.value).subscribe({
      next: (response) => console.log(response),
      error: (error) => console.log(error),
      complete: () => {
        this.vulnerabilityForm.reset();
        this.router.navigate(['']);
        
    }
      
    });
  } else {
    return;
  }
  }


}
